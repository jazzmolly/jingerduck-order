<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>薑薑-九珍薑母鴨線上點餐</title>
  <style>
    :root{
      --brand:#b22222;
      --muted:#666;
      --card-bg:#fff7f7;
      --gap:12px;
    }
    *{box-sizing:border-box}
    body{font-family: "Noto Sans TC", Arial, sans-serif; margin:0; background:#fafafa; color:#222; padding:20px;}
    header{display:flex; align-items:center; gap:12px; margin-bottom:14px;}
    h1{margin:0; color:var(--brand); font-size:1.4rem;}
    .container{max-width:980px; margin:0 auto; background:white; padding:18px; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.06);}
    .menu-grid{display:grid; grid-template-columns: 1fr 90px 100px; gap:8px; align-items:center;}
    .menu-row{display:contents;}
    .item-name{padding:10px 8px; border-bottom:1px dashed #eee;}
    .item-price{padding:10px 8px; text-align:right; color:var(--muted); border-bottom:1px dashed #eee;}
    .item-action{padding:10px 8px; text-align:right; border-bottom:1px dashed #eee;}
    
    /* 數量控制器的通用樣式 */
    .qty-container {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 64px;
      position: relative;
    }
    
    /* 電腦版：使用原生數量輸入框 */
    .qty-desktop {
      width: 100%;
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #ddd;
      text-align: center;
      font-size: 14px;
      background: white;
      color: #333;
      /* 確保電腦版顯示箭頭 */
      -webkit-appearance: auto;
      -moz-appearance: number-input;
      appearance: auto;
      min-height: 34px;
    }
    
    /* 手機版：自訂加減按鈕 */
    .qty-mobile {
      display: none;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      height: 38px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 0 4px;
    }
    
    .qty-btn {
      width: 28px;
      height: 28px;
      border: none;
      border-radius: 4px;
      background: #f5f5f5;
      color: #666;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    
    .qty-btn:hover {
      background: #e8e8e8;
    }
    
    .qty-btn:active {
      background: #ddd;
      transform: scale(0.95);
    }
    
    .qty-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    .qty-value {
      min-width: 28px;
      text-align: center;
      font-size: 14px;
      font-weight: 500;
      color: #333;
      border: none;
      background: transparent;
      padding: 0 4px;
    }
    
    .qty-value:focus {
      outline: none;
      background: #f9f9f9;
    }
    
    /* 禁用狀態 */
    .qty-container.disabled .qty-desktop,
    .qty-container.disabled .qty-mobile {
      background: #f8f8f8;
      color: #999;
      border-color: #e0e0e0;
    }
    
    .qty-container.disabled .qty-btn {
      background: #f0f0f0;
      color: #ccc;
      cursor: not-allowed;
    }
    
    .total-box{display:flex; justify-content:space-between; align-items:center; margin-top:14px; padding:12px; background:var(--card-bg); border-radius:8px;}
    #total{font-size:1.25rem; font-weight:700;}
    button.primary{background:var(--brand); color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer;}
    button.secondary{background:transparent; border:1px solid #ddd; padding:8px 12px; border-radius:8px; cursor:pointer;}
    .controls{display:flex; gap:8px; margin-top:12px; flex-wrap:wrap;}
    form.row{display:flex; gap:8px; margin-top:12px; flex-wrap:wrap;}
    input[type="text"], input[type="tel"], input[type="datetime-local"], textarea{padding:8px; border-radius:6px; border:1px solid #ddd; min-width:180px;}
    .payment-area{margin-top:16px; display:none; padding:12px; border:1px dashed #e2e2e2; border-radius:8px; background:#fff;}
    .qr{max-width:220px;}
    .note{color:var(--muted); font-size:0.95rem; margin-top:8px;}
    .summary{white-space:pre-wrap; font-family:monospace; background:#fff; padding:8px; border-radius:6px; border:1px solid #eee; margin-top:10px;}
    footer{margin-top:18px; color:#888; font-size:0.9rem;}
    
    /* 手機版樣式 */
    @media (max-width: 768px) {
      .menu-grid{grid-template-columns: 1fr 85px 90px;}
      
      /* 手機版隱藏原生輸入框，顯示自訂按鈕 */
      .qty-desktop {
        display: none;
      }
      
      .qty-mobile {
        display: flex;
      }
      
      .qty-container {
        width: 80px;
      }
      
      .qty-btn {
        width: 32px;
        height: 32px;
        font-size: 18px;
      }
      
      .qty-value {
        min-width: 32px;
        font-size: 16px;
      }
    }
    
    /* 小尺寸手機優化 */
    @media (max-width: 480px) {
      .qty-container {
        width: 75px;
      }
      
      .qty-btn {
        width: 30px;
        height: 30px;
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <h1>薑薑 薑母鴨 — 線上點餐test2</h1>
    </header>

    <section aria-labelledby="menu-title">
      <h2 id="menu-title" style="font-size:1rem; margin:0 0 8px 0; color:var(--muted)">請勾選想要的品項並調整數量（價格單位：NT$）</h2>

      <div class="menu-grid" id="menu">
        <!-- Header row -->
        <div style="font-weight:700; padding:8px 0">品名</div>
        <div style="font-weight:700; text-align:right; padding:8px 0">單價</div>
        <div style="font-weight:700; text-align:right; padding:8px 0">數量</div>

        <!-- Menu items inserted by JavaScript -->
      </div>

      <div class="total-box" aria-live="polite">
        <div>
          <div style="font-size:0.95rem; color:var(--muted)">目前訂購金額</div>
          <div id="total" aria-atomic="true">NT$0</div>
        </div>

        <div style="text-align:right;">
          <div style="font-size:0.9rem; color:var(--muted)">建議付款尾數（用來快速對單）</div>
          <div id="tail" style="font-weight:700; margin-top:6px;">—</div>
        </div>
      </div>

      <div class="controls">
        <button class="primary" id="btn-submit">準備付款並顯示 QR</button>
        <button class="secondary" id="btn-clear">清除選單</button>
      </div>
    </section>

    <section aria-labelledby="info-title">
      <h3 id="info-title" style="margin-top:14px">取餐 / 聯絡資訊</h3>
      <form id="order-form" onsubmit="return false;">
        <div class="row">
          <input type="text" id="cust-name" placeholder="姓名（取餐時出示）" required>
          <input type="tel" id="cust-tel" placeholder="電話（必要）" required>
        </div>
        <div class="row">
          <input type="datetime-local" id="pickup-time" placeholder="預計取餐時間（選填）">
          <input type="text" id="note" placeholder="備註（例如辣度、同行備註）">
        </div>
        <div style="margin-top:8px; font-size:0.95rem; color:var(--muted)">
          顧客付款後建議：請截圖付款完成畫面或記下最後 5 碼以供取餐核對。
        </div>
      </form>
    </section>

    <!-- Payment area (hidden until submit) -->
    <section id="paymentArea" class="payment-area" aria-hidden="true">
      <h3>請掃描街口 QR 完成付款</h3>
      <div style="display:flex; gap:18px; align-items:center; flex-wrap:wrap;">
        <div>
          <!-- Replace "jkpay.png" with your actual QR code file or URL -->
          <img id="qrImg" class="qr" src="jkpay.png" alt="街口支付 QR Code（請替換成自己的圖檔）">
        </div>
        <div style="max-width:420px;">
          <div style="font-weight:700; margin-bottom:6px">付款說明（請務必依序操作）</div>
          <ol style="padding-left:18px; margin:0; color:var(--muted)">
            <li>請掃描上方 QR Code。</li>
            <li>付款時請在「備註」或轉帳時註記：<strong id="showTail">尾數 · —</strong>（或直接截圖上傳）。</li>
            <li>付款完成後，請保留截圖或記下付款帳號的末五碼以便取餐核對。</li>
          </ol>
          <div class="note">若你希望我們自動收到訂單通知，請將下方訂單資訊寄給我們（按下「寄送訂單 Email」）或截圖付款後來電/來訊告知。</div>
        </div>
      </div>

      <div style="margin-top:12px; display:flex; gap:8px;">
        <button class="primary" id="btn-mail">寄送訂單 Email 給我（店家）</button>
        <button class="secondary" id="btn-done">我已付款（顧客點）</button>
      </div>

      <div id="orderSummary" class="summary" aria-live="polite" style="display:none; margin-top:12px;"></div>
    </section>

    <footer>
      <div>備註：此為簡易點餐頁面，建議測試完畢後上傳至 GitHub Pages / Netlify 取得固定網址並貼到 FB。</div>
    </footer>
  </div>

  <script>
    // 檢測是否為手機設備
    function isMobile() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
    }

    // ----- 菜單資料 -----
    const menuData = [
      { name: "薑母鴨（小, 6塊肉+1000g 湯底）", price: 250 },
      { name: "薑母鴨（中, 9塊肉+1600g 湯底）", price: 350 },
      { name: "薑母鴨（大, 12塊肉+2300g 湯底）", price: 450 },

      { name: "鴨肉丸", price: 60 },
      { name: "鴨爪", price: 60 },
      { name: "鴨胗", price: 60 },
      { name: "鴨腱", price: 60 },
      { name: "鴨腸", price: 60 },
      { name: "鴨心", price: 60 },
      { name: "鴨肝", price: 60 },

      { name: "香菇", price: 60 },
      { name: "金針菇", price: 60 },
      { name: "杏包菇", price: 60 },
      { name: "米血糕", price: 60 },
      { name: "鑫鑫腸", price: 60 },
      { name: "豆皮", price: 60 },
      { name: "燒麻吉", price: 60 },
      { name: "麵線 (現場製作）", price: 50 },

      { name: "牛五花", price: 100 },
      { name: "羊肉片", price: 100 },
      { name: "豬肉片", price: 90 },
      { name: "雞胸肉", price: 90 },
      { name: "魚片", price: 100 },
      { name: "薑汁", price: 50 },

      { name: "鴨血", price: 60 },
      { name: "凍豆腐", price: 60 },
      { name: "百頁豆腐", price: 60 }
    ];

    // ----- 插入菜單到 DOM -----
    const menuEl = document.getElementById('menu');
    const isMobileDevice = isMobile();

    menuData.forEach((it, idx) => {
      // 品名
      const nameDiv = document.createElement('div');
      nameDiv.className = 'item-name';
      const cbId = `cb-${idx}`;
      nameDiv.innerHTML = `
        <label style="display:flex; gap:8px; align-items:center;">
          <input type="checkbox" id="${cbId}" data-price="${it.price}" aria-label="${it.name}" />
          <span>${it.name}</span>
        </label>
      `;

      // 價格
      const priceDiv = document.createElement('div');
      priceDiv.className = 'item-price';
      priceDiv.textContent = it.price;

      // 數量容器
      const actionDiv = document.createElement('div');
      actionDiv.className = 'item-action';
      const qtyId = `qty-${idx}`;
      
      if (isMobileDevice) {
        // 手機版：加減按鈕
        actionDiv.innerHTML = `
          <div class="qty-container disabled" id="qty-container-${idx}">
            <div class="qty-mobile">
              <button type="button" class="qty-btn" id="minus-${idx}" disabled>-</button>
              <input type="text" class="qty-value" id="${qtyId}" value="1" readonly aria-label="數量">
              <button type="button" class="qty-btn" id="plus-${idx}" disabled>+</button>
            </div>
          </div>
        `;
      } else {
        // 電腦版：原生數量輸入框
        actionDiv.innerHTML = `
          <div class="qty-container">
            <input type="number" id="${qtyId}" class="qty-desktop" value="1" min="1" step="1" disabled aria-label="數量">
          </div>
        `;
      }

      menuEl.appendChild(nameDiv);
      menuEl.appendChild(priceDiv);
      menuEl.appendChild(actionDiv);

      // 事件綁定
      const cb = nameDiv.querySelector('input[type="checkbox"]');
      let qtyElement;

      if (isMobileDevice) {
        const container = document.getElementById(`qty-container-${idx}`);
        const minusBtn = document.getElementById(`minus-${idx}`);
        const plusBtn = document.getElementById(`plus-${idx}`);
        qtyElement = document.getElementById(qtyId);

        // 點擊 checkbox 時切換數量控制器的啟用狀態
        cb.addEventListener('change', () => {
          const isEnabled = cb.checked;
          container.classList.toggle('disabled', !isEnabled);
          minusBtn.disabled = !isEnabled;
          plusBtn.disabled = !isEnabled;
          qtyElement.readOnly = !isEnabled;
          
          if (isEnabled && (!qtyElement.value || parseInt(qtyElement.value) < 1)) {
            qtyElement.value = 1;
          }
          calculateTotal();
        });

        // 加減按鈕事件
        minusBtn.addEventListener('click', () => {
          if (!minusBtn.disabled) {
            let current = parseInt(qtyElement.value) || 1;
            if (current > 1) {
              qtyElement.value = current - 1;
              calculateTotal();
            }
          }
        });

        plusBtn.addEventListener('click', () => {
          if (!plusBtn.disabled) {
            let current = parseInt(qtyElement.value) || 1;
            qtyElement.value = current + 1;
            calculateTotal();
          }
        });

        // 手動輸入驗證
        qtyElement.addEventListener('input', (e) => {
          let value = parseInt(e.target.value);
          if (isNaN(value) || value < 1) {
            e.target.value = 1;
          }
          calculateTotal();
        });

        // 防止長按數字鍵盤
        qtyElement.addEventListener('focus', () => {
          setTimeout(() => {
            qtyElement.blur();
          }, 100);
        });

      } else {
        // 電腦版事件
        qtyElement = document.getElementById(qtyId);
        
        cb.addEventListener('change', () => {
          qtyElement.disabled = !cb.checked;
          if (cb.checked && (!qtyElement.value || parseInt(qtyElement.value) < 1)) {
            qtyElement.value = 1;
          }
          calculateTotal();
        });

        qtyElement.addEventListener('input', () => {
          if (!qtyElement.value || parseInt(qtyElement.value) < 1) {
            qtyElement.value = 1;
          }
          calculateTotal();
        });
      }
    });

    // ----- 計算總金額 & 建議尾數 -----
    function calculateTotal() {
      let total = 0;
      menuData.forEach((it, idx) => {
        const cb = document.getElementById(`cb-${idx}`);
        const qty = document.getElementById(`qty-${idx}`);
        if (cb && cb.checked) {
          const price = Number(cb.getAttribute('data-price'));
          const count = Number(qty.value || 0);
          total += price * count;
        }
      });
      document.getElementById('total').textContent = "NT$" + total;

      // 產生建議尾數（2至3位數），方便對單
      const tail = generateTail(total);
      document.getElementById('tail').textContent = tail ? ("+" + tail) : "—";
      document.getElementById('showTail').textContent = "尾數 · " + (tail ? ("+" + tail) : "—");
    }

    // 產生尾數：基於金額與時間雜湊得到 2~3 位數
    function generateTail(total) {
      if (!total || total <= 0) return null;
      const now = Date.now();
      const str = String(total) + String(now);
      const tail = str.slice(-3);
      return tail;
    }

    // ----- 清除選單 -----
    document.getElementById('btn-clear').addEventListener('click', () => {
      menuData.forEach((_, idx) => {
        const cb = document.getElementById(`cb-${idx}`);
        const qty = document.getElementById(`qty-${idx}`);
        if (cb) cb.checked = false;
        
        if (isMobileDevice) {
          const container = document.getElementById(`qty-container-${idx}`);
          const minusBtn = document.getElementById(`minus-${idx}`);
          const plusBtn = document.getElementById(`plus-${idx}`);
          if (qty) qty.value = 1;
          if (container) container.classList.add('disabled');
          if (minusBtn) minusBtn.disabled = true;
          if (plusBtn) plusBtn.disabled = true;
          if (qty) qty.readOnly = true;
        } else {
          if (qty) { 
            qty.value = 1; 
            qty.disabled = true; 
          }
        }
      });
      calculateTotal();
      hidePaymentArea();
    });

    // ----- 顯示付款區塊 & 處理送單 -----
    document.getElementById('btn-submit').addEventListener('click', () => {
      const totalText = document.getElementById('total').textContent;
      if (totalText === "NT$0") {
        alert("請先選擇餐點再付款！");
        return;
      }
      showPaymentArea();
      renderOrderSummary();
    });

    function showPaymentArea(){
      const pa = document.getElementById('paymentArea');
      pa.style.display = 'block';
      pa.setAttribute('aria-hidden','false');
    }
    function hidePaymentArea(){
      const pa = document.getElementById('paymentArea');
      pa.style.display = 'none';
      pa.setAttribute('aria-hidden','true');
    }

    // ----- 訂單摘要 -----
    function getOrderObject(){
      const items = [];
      let total = 0;
      menuData.forEach((it, idx) => {
        const cb = document.getElementById(`cb-${idx}`);
        const qty = document.getElementById(`qty-${idx}`);
        if (cb && cb.checked){
          const count = Number(qty.value || 0);
          const subtotal = it.price * count;
          items.push({ name: it.name, price: it.price, qty: count, subtotal});
          total += subtotal;
        }
      });
      const tail = generateTail(total);
      const customer = {
        name: document.getElementById('cust-name').value || "(未填)",
        tel: document.getElementById('cust-tel').value || "(未填)",
        pickup: document.getElementById('pickup-time').value || "(未填)",
        note: document.getElementById('note').value || ""
      };
      return { items, total, tail, customer };
    }

    function renderOrderSummary(){
      const obj = getOrderObject();
      let txt = `訂單明細：\n`;
      obj.items.forEach(i=>{
        txt += `${i.name} × ${i.qty}  → NT$${i.subtotal}\n`;
      });
      txt += `\n總金額：NT$${obj.total}\n建議付款尾數：+${obj.tail}\n\n`;
      txt += `取餐人：${obj.customer.name}\n電話：${obj.customer.tel}\n預計取餐時間：${obj.customer.pickup}\n備註：${obj.customer.note}\n`;

      const el = document.getElementById('orderSummary');
      el.style.display = 'block';
      el.textContent = txt;
    }

    // ----- 寄送 Email（mailto） -----
    document.getElementById('btn-mail').addEventListener('click', () => {
      const obj = getOrderObject();
      if (!obj.items.length) return alert("沒有任何訂單內容！");
      const shopEmail = "yourshop@example.com";
      const subject = encodeURIComponent("線上訂單通知 - " + (obj.customer.name || "未填姓名"));
      let body = `【線上訂單】%0A%0A`;
      obj.items.forEach(i=>{
        body += `${i.name} × ${i.qty}  → NT$${i.subtotal}%0A`;
      });
      body += `%0A總金額：NT$${obj.total}%0A建議付款尾數：+${obj.tail}%0A%0A`;
      body += `取餐人：${obj.customer.name}%0A電話：${obj.customer.tel}%0A取餐時間：${obj.customer.pickup}%0A備註：${obj.customer.note}%0A`;
      body += `%0A（顧客付款後請回報付款截圖或末五碼）%0A`;

      window.location.href = `mailto:${shopEmail}?subject=${subject}&body=${body}`;
    });

    // ----- 我已付款（顧客點） -----
    document.getElementById('btn-done').addEventListener('click', () => {
      const obj = getOrderObject();
      if (!obj.items.length) return alert("沒有任何訂單內容！");
      const ans = confirm("已完成付款？建議請上傳付款截圖或將最後五碼傳給店家以利核對。按「確定」將顯示可複製的訂單摘要頁面。");
      if (ans) {
        renderOrderSummary();
        alert("感謝付款！請截圖此頁或將付款截圖傳給店家以便核對。");
      }
    });

    // 初始
    calculateTotal();
  </script>
</body>
</html>


