<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>薑薑-九珍薑母鴨線上點餐</title>
  <style>
    :root{
      --brand:#b22222;
      --muted:#666;
      --card-bg:#fff7f7;
      --gap:12px;
    }
    *{box-sizing:border-box}
    body{font-family: "Noto Sans TC", Arial, sans-serif; margin:0; background:#fafafa; color:#222; padding:20px;}
    header{display:flex; align-items:center; gap:12px; margin-bottom:14px;}
    h1{margin:0; color:var(--brand); font-size:1.4rem;}
    .container{max-width:980px; margin:0 auto; background:white; padding:18px; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.06);}
    .menu-grid{display:grid; grid-template-columns: 1fr 90px 100px; gap:8px; align-items:center;}
    .menu-row{display:contents;}
    .item-name{padding:10px 8px; border-bottom:1px dashed #eee;}
    .item-price{padding:10px 8px; text-align:right; color:var(--muted); border-bottom:1px dashed #eee;}
    .item-action{padding:10px 8px; text-align:right; border-bottom:1px dashed #eee;}
    
    /* 數量輸入框樣式 - 確保箭頭顯示 */
    .qty {
      width:64px; 
      padding:6px; 
      border-radius:6px; 
      border:1px solid #ddd; 
      text-align:center;
      /* 確保顯示上下箭頭 */
      -webkit-appearance: auto !important;
      -moz-appearance: number-input !important;
      appearance: auto !important;
      /* 移除 iOS 的自訂樣式 */
      -webkit-appearance: auto;
      /* 確保在 Webkit 瀏覽器中顯示箭頭 */
      -webkit-user-select: auto;
      /* 設定最小高度確保箭頭有足夠空間 */
      min-height: 34px;
      /* 確保輸入框可點擊 */
      pointer-events: auto;
      /* 移除任何可能隱藏箭頭的樣式 */
      background: white;
      color: #333;
      font-size: 14px;
      font-family: inherit;
    }
    
    /* 為 iOS 設備添加額外樣式 */
    @supports (-webkit-touch-callout: none) {
      .qty {
        padding: 8px 6px 8px 6px; /* 為 iOS 增加內邊距 */
        min-height: 40px;
        /* 強制顯示箭頭 */
        -webkit-appearance: number-field !important;
      }
    }
    
    /* 確保在所有瀏覽器中箭頭可見 */
    .qty::-webkit-outer-spin-button,
    .qty::-webkit-inner-spin-button {
      -webkit-appearance: inner-spin-button !important;
      opacity: 1;
    }
    
    .qty[type="number"] {
      -moz-appearance: textfield; /* Firefox */
    }
    
    .total-box{display:flex; justify-content:space-between; align-items:center; margin-top:14px; padding:12px; background:var(--card-bg); border-radius:8px;}
    #total{font-size:1.25rem; font-weight:700;}
    button.primary{background:var(--brand); color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer;}
    button.secondary{background:transparent; border:1px solid #ddd; padding:8px 12px; border-radius:8px; cursor:pointer;}
    .controls{display:flex; gap:8px; margin-top:12px; flex-wrap:wrap;}
    form.row{display:flex; gap:8px; margin-top:12px; flex-wrap:wrap;}
    input[type="text"], input[type="tel"], input[type="datetime-local"], textarea{padding:8px; border-radius:6px; border:1px solid #ddd; min-width:180px;}
    .payment-area{margin-top:16px; display:none; padding:12px; border:1px dashed #e2e2e2; border-radius:8px; background:#fff;}
    .qr{max-width:220px;}
    .note{color:var(--muted); font-size:0.95rem; margin-top:8px;}
    .summary{white-space:pre-wrap; font-family:monospace; background:#fff; padding:8px; border-radius:6px; border:1px solid #eee; margin-top:10px;}
    footer{margin-top:18px; color:#888; font-size:0.9rem;}
    
    @media (max-width:720px){
      .menu-grid{grid-template-columns: 1fr 85px 90px;}
      .qty{
        width:54px;
        min-height: 36px;
      }
    }
    
    /* 額外的手機版優化 */
    @media (max-width: 480px) {
      .qty {
        width: 50px;
        min-height: 38px;
        font-size: 16px; /* 增加字體大小讓箭頭更容易點擊 */
      }
    }
  </style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <h1>薑母鴨 — 線上點餐</h1>
    </header>

    <section aria-labelledby="menu-title">
      <h2 id="menu-title" style="font-size:1rem; margin:0 0 8px 0; color:var(--muted)">請勾選想要的品項並調整數量（價格單位：NT$）</h2>

      <div class="menu-grid" id="menu">
        <!-- Header row -->
        <div style="font-weight:700; padding:8px 0">品名</div>
        <div style="font-weight:700; text-align:right; padding:8px 0">單價</div>
        <div style="font-weight:700; text-align:right; padding:8px 0">數量</div>

        <!-- Menu items inserted by JavaScript -->
      </div>

      <div class="total-box" aria-live="polite">
        <div>
          <div style="font-size:0.95rem; color:var(--muted)">目前訂購金額</div>
          <div id="total" aria-atomic="true">NT$0</div>
        </div>

        <div style="text-align:right;">
          <div style="font-size:0.9rem; color:var(--muted)">建議付款尾數（用來快速對單）</div>
          <div id="tail" style="font-weight:700; margin-top:6px;">—</div>
        </div>
      </div>

      <div class="controls">
        <button class="primary" id="btn-submit">準備付款並顯示 QR</button>
        <button class="secondary" id="btn-clear">清除選單</button>
      </div>
    </section>

    <section aria-labelledby="info-title">
      <h3 id="info-title" style="margin-top:14px">取餐 / 聯絡資訊</h3>
      <form id="order-form" onsubmit="return false;">
        <div class="row">
          <input type="text" id="cust-name" placeholder="姓名（取餐時出示）" required>
          <input type="tel" id="cust-tel" placeholder="電話（必要）" required>
        </div>
        <div class="row">
          <input type="datetime-local" id="pickup-time" placeholder="預計取餐時間（選填）">
          <input type="text" id="note" placeholder="備註（例如辣度、同行備註）">
        </div>
        <div style="margin-top:8px; font-size:0.95rem; color:var(--muted)">
          顧客付款後建議：請截圖付款完成畫面或記下最後 5 碼以供取餐核對。
        </div>
      </form>
    </section>

    <!-- Payment area (hidden until submit) -->
    <section id="paymentArea" class="payment-area" aria-hidden="true">
      <h3>請掃描街口 QR 完成付款</h3>
      <div style="display:flex; gap:18px; align-items:center; flex-wrap:wrap;">
        <div>
          <!-- Replace "jkpay.png" with your actual QR code file or URL -->
          <img id="qrImg" class="qr" src="jkpay.png" alt="街口支付 QR Code（請替換成自己的圖檔）">
        </div>
        <div style="max-width:420px;">
          <div style="font-weight:700; margin-bottom:6px">付款說明（請務必依序操作）</div>
          <ol style="padding-left:18px; margin:0; color:var(--muted)">
            <li>請掃描上方 QR Code。</li>
            <li>付款時請在「備註」或轉帳時註記：<strong id="showTail">尾數 · —</strong>（或直接截圖上傳）。</li>
            <li>付款完成後，請保留截圖或記下付款帳號的末五碼以便取餐核對。</li>
          </ol>
          <div class="note">若你希望我們自動收到訂單通知，請將下方訂單資訊寄給我們（按下「寄送訂單 Email」）或截圖付款後來電/來訊告知。</div>
        </div>
      </div>

      <div style="margin-top:12px; display:flex; gap:8px;">
        <button class="primary" id="btn-mail">寄送訂單 Email 給我（店家）</button>
        <button class="secondary" id="btn-done">我已付款（顧客點）</button>
      </div>

      <div id="orderSummary" class="summary" aria-live="polite" style="display:none; margin-top:12px;"></div>
    </section>

    <footer>
      <div>備註：此為簡易點餐頁面，建議測試完畢後上傳至 GitHub Pages / Netlify 取得固定網址並貼到 FB。</div>
    </footer>
  </div>

  <script>
    // ----- 菜單資料 -----
    const menuData = [
      { name: "薑母鴨（小, 6塊肉+1000g 湯底）", price: 250 },
      { name: "薑母鴨（中, 9塊肉+1600g 湯底）", price: 350 },
      { name: "薑母鴨（大, 12塊肉+2300g 湯底）", price: 450 },

      { name: "鴨肉丸", price: 60 },
      { name: "鴨爪", price: 60 },
      { name: "鴨胗", price: 60 },
      { name: "鴨腱", price: 60 },
      { name: "鴨腸", price: 60 },
      { name: "鴨心", price: 60 },
      { name: "鴨肝", price: 60 },

      { name: "香菇", price: 60 },
      { name: "金針菇", price: 60 },
      { name: "杏包菇", price: 60 },
      { name: "米血糕", price: 60 },
      { name: "鑫鑫腸", price: 60 },
      { name: "豆皮", price: 60 },
      { name: "燒麻吉", price: 60 },
      { name: "麵線 (現場製作）", price: 50 },

      { name: "牛五花", price: 100 },
      { name: "羊肉片", price: 100 },
      { name: "豬肉片", price: 90 },
      { name: "雞胸肉", price: 90 },
      { name: "魚片", price: 100 },
      { name: "薑汁", price: 50 },

      { name: "鴨血", price: 60 },
      { name: "凍豆腐", price: 60 },
      { name: "百頁豆腐", price: 60 }
    ];

    // ----- 插入菜單到 DOM -----
    const menuEl = document.getElementById('menu');

    menuData.forEach((it, idx) => {
      // 品名
      const nameDiv = document.createElement('div');
      nameDiv.className = 'item-name';
      const cbId = `cb-${idx}`;
      nameDiv.innerHTML = `
        <label style="display:flex; gap:8px; align-items:center;">
          <input type="checkbox" id="${cbId}" data-price="${it.price}" aria-label="${it.name}" />
          <span>${it.name}</span>
        </label>
      `;

      // 價格
      const priceDiv = document.createElement('div');
      priceDiv.className = 'item-price';
      priceDiv.textContent = it.price;

      // 數量
      const actionDiv = document.createElement('div');
      actionDiv.className = 'item-action';
      const qtyId = `qty-${idx}`;
      actionDiv.innerHTML = `<input type="number" id="${qtyId}" class="qty" value="1" min="1" step="1" disabled aria-label="數量">`;

      menuEl.appendChild(nameDiv);
      menuEl.appendChild(priceDiv);
      menuEl.appendChild(actionDiv);

      // 事件綁定
      const cb = nameDiv.querySelector('input[type="checkbox"]');
      const qty = actionDiv.querySelector('input[type="number"]');

      cb.addEventListener('change', () => {
        qty.disabled = !cb.checked;
        if (cb.checked && (!qty.value || qty.value < 1)) qty.value = 1;
        // 當啟用時，強制更新以確保箭頭顯示
        if (cb.checked) {
          qty.focus();
          qty.blur(); // 觸發樣式更新
        }
        calculateTotal();
      });

      qty.addEventListener('input', () => {
        if (!qty.value || parseInt(qty.value) < 1) qty.value = 1;
        calculateTotal();
      });

      // 添加點擊事件，讓使用者更容易點擊箭頭
      qty.addEventListener('click', (e) => {
        if (!qty.disabled) {
          // 確保輸入框獲得焦點
          e.target.focus();
        }
      });
    });

    // ----- 計算總金額 & 建議尾數 -----
    function calculateTotal() {
      let total = 0;
      menuData.forEach((it, idx) => {
        const cb = document.getElementById(`cb-${idx}`);
        const qty = document.getElementById(`qty-${idx}`);
        if (cb && cb.checked) {
          const price = Number(cb.getAttribute('data-price'));
          const count = Number(qty.value || 0);
          total += price * count;
        }
      });
      document.getElementById('total').textContent = "NT$" + total;

      // 產生建議尾數（2至3位數），方便對單。例如：在總額後加入尾數(例如 +27)
      // 我們用總額與時間混合產生一組短尾數，顧客付款時請把尾數放在備註或轉帳末尾。
      const tail = generateTail(total);
      document.getElementById('tail').textContent = tail ? ("+" + tail) : "—";
      document.getElementById('showTail').textContent = "尾數 · " + (tail ? ("+" + tail) : "—");
    }

    // 產生尾數：基於金額與時間雜湊得到 2~3 位數 (避免重複機率低)
    function generateTail(total) {
      if (!total || total <= 0) return null;
      const now = Date.now();
      // 簡單 hash：取 total + timestamp 的字串最後 3 位
      const str = String(total) + String(now);
      const tail = str.slice(-3); // 3 位
      // 若尾數以 0 開頭，也接受（顧客可直接輸入）
      return tail;
    }

    // ----- 清除選單 -----
    document.getElementById('btn-clear').addEventListener('click', () => {
      menuData.forEach((_, idx) => {
        const cb = document.getElementById(`cb-${idx}`);
        const qty = document.getElementById(`qty-${idx}`);
        if (cb) cb.checked = false;
        if (qty) { qty.value = 1; qty.disabled = true; }
      });
      calculateTotal();
      hidePaymentArea();
    });

    // ----- 顯示付款區塊 & 處理送單 -----
    document.getElementById('btn-submit').addEventListener('click', () => {
      const totalText = document.getElementById('total').textContent;
      if (totalText === "NT$0") {
        alert("請先選擇餐點再付款！");
        return;
      }
      // 顯示付款區
      showPaymentArea();

      // 顯示訂單摘要
      renderOrderSummary();
    });

    function showPaymentArea(){
      const pa = document.getElementById('paymentArea');
      pa.style.display = 'block';
      pa.setAttribute('aria-hidden','false');
    }
    function hidePaymentArea(){
      const pa = document.getElementById('paymentArea');
      pa.style.display = 'none';
      pa.setAttribute('aria-hidden','true');
    }

    // ----- 訂單摘要 -----
    function getOrderObject(){
      const items = [];
      let total = 0;
      menuData.forEach((it, idx) => {
        const cb = document.getElementById(`cb-${idx}`);
        const qty = document.getElementById(`qty-${idx}`);
        if (cb && cb.checked){
          const count = Number(qty.value || 0);
          const subtotal = it.price * count;
          items.push({ name: it.name, price: it.price, qty: count, subtotal});
          total += subtotal;
        }
      });
      const tail = generateTail(total);
      const customer = {
        name: document.getElementById('cust-name').value || "(未填)",
        tel: document.getElementById('cust-tel').value || "(未填)",
        pickup: document.getElementById('pickup-time').value || "(未填)",
        note: document.getElementById('note').value || ""
      };
      return { items, total, tail, customer };
    }

    function renderOrderSummary(){
      const obj = getOrderObject();
      let txt = `訂單明細：\n`;
      obj.items.forEach(i=>{
        txt += `${i.name} × ${i.qty}  → NT$${i.subtotal}\n`;
      });
      txt += `\n總金額：NT$${obj.total}\n建議付款尾數：+${obj.tail}\n\n`;
      txt += `取餐人：${obj.customer.name}\n電話：${obj.customer.tel}\n預計取餐時間：${obj.customer.pickup}\n備註：${obj.customer.note}\n`;

      const el = document.getElementById('orderSummary');
      el.style.display = 'block';
      el.textContent = txt;
    }

    // ----- 寄送 Email（mailto） -----
    document.getElementById('btn-mail').addEventListener('click', () => {
      const obj = getOrderObject();
      if (!obj.items.length) return alert("沒有任何訂單內容！");
      // 請把下面的店家 email 換成你的 email
      const shopEmail = "yourshop@example.com";
      const subject = encodeURIComponent("線上訂單通知 - " + (obj.customer.name || "未填姓名"));
      let body = `【線上訂單】%0A%0A`;
      obj.items.forEach(i=>{
        body += `${i.name} × ${i.qty}  → NT$${i.subtotal}%0A`;
      });
      body += `%0A總金額：NT$${obj.total}%0A建議付款尾數：+${obj.tail}%0A%0A`;
      body += `取餐人：${obj.customer.name}%0A電話：${obj.customer.tel}%0A取餐時間：${obj.customer.pickup}%0A備註：${obj.customer.note}%0A`;
      body += `%0A（顧客付款後請回報付款截圖或末五碼）%0A`;

      // 開啟 mailto
      window.location.href = `mailto:${shopEmail}?subject=${subject}&body=${body}`;
    });

    // ----- 我已付款（顧客點） -----
    document.getElementById('btn-done').addEventListener('click', () => {
      const obj = getOrderObject();
      if (!obj.items.length) return alert("沒有任何訂單內容！");
      const ans = confirm("已完成付款？建議請上傳付款截圖或將最後五碼傳給店家以利核對。按「確定」將顯示可複製的訂單摘要頁面。");
      if (ans) {
        renderOrderSummary();
        // 把訂單摘要顯示在視窗，使用者可以長按複製或截圖
        alert("感謝付款！請截圖此頁或將付款截圖傳給店家以便核對。");
      }
    });

    // 初始
    calculateTotal();
  </script>
</body>
</html>
